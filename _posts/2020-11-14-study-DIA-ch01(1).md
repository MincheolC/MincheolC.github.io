---
title: '[DIA] 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션(1)'
excerpt: '[Designing Data-Intensive Application] 1장 "신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션" 중 신뢰성과 확장성에 대해 정리한 글'
categories:
  - study
toc: true
---

본 글은 Martin Kleppmann(마틴 클레프만)이 지은 "데이터 중심 어플리케이션 설계"라는 책을 공부하며 정리한 내용이다. 책의 내용 중 1장 "신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션"의 **신뢰성과 확장성**에 대해 정리한 글이다.

> 오늘날 많은 애플리케이션은 계산 중심(compute-intensive)와 다르게 데이터 **중심(data-intensive)적**이다. 이러한 애플리케이션의 경우 CPU 성능은 더 이상 애플리케이션을 제한하는 요소가 아니며, **더 큰 문제는 데이터의 양, 데이터의 복잡도, 데이터 변화 속도**이다. 이 책은 데이터 시스템의 원칙과 실용성, 그리고 이를 활용한 데이터 중심 애플리케이션을 개발하는 방법을 모두 담고 있다. -마틴 클레프만-

## 데이터 시스템에 대한 생각

저자는 다음과 같은 이유로 DB, 큐, 캐시 등 서로 다른 범주에 속하는 도구들을 **데이터 시스템**이라는 포괄적 용어로 묶어야 한다고 말한다.

- 새로운 도구들은 다양한 사용 사례에 최적화 됐기 때문에 더 이상 전통적인 분류에 딱 들어맞지 않고, 분류 간 경계가 흐려지고 있음.
- 점점 더 많은 애플리케이션이 단일 도구로는 더 이상 데이터 처리와 저장을 모두 만족시킬 수 없는 과도하고 광범위한 요구사항을 가지고 있음. 대신 작업(work)을 단일 도구에서 효율적으로 수행할 수 있는 태스크(task)로 나누고 다양한 도구들은 애플리케이션 코드를 이용해 서로 연결함.

서비스 제공을 위해 좀 더 작은 범용 구성요소들로 특수한 목적의 데이터 시스템을 만든다. **개발자는 애플리케이션 개발자뿐만 아니라 데이터 시스템 설계자**이기도 하다.

그렇다면, 내부적으로 문제가 있어도 데이터를 정확하고 완전하게 유지하려면 어떻게 해야할까? 시스템의 일부 성능이 저하되더라도 클라이언트에 일관되게 좋은 성능을 어떻게 제공할 수 있을까?
부하 증가를 다루기 위해 어떻게 규모를 확장할까? 서비스를 위해 좋은 API는 어떤 모습일까?

이 책에서는 대부분의 소프트웨어 시스템에서 중요하게 여기는 세 가지 관심사에 중점을 둔다.

- 신뢰성 (Reliabilty)
- 확장성 (Scalability)
- 유지보수성 (Maintainability)

## 신뢰성

> 하드웨어나 소프트웨어 결함. 심지어 인적 오류(human error)같은 역경에 직면하더라도 시스템은 지속적으로 올바르게 동작(원하는 성능 수준에서 정확한 기능을 수행)해야한다.

**결함(Fault)**은 잘못될 수 있는 일을 의미한다. 결함을 예측하고 대처할 수 있는 시스템을 내결함성(fault-tolerant) 또는 탄력성(resilient)을 지녔다고 말한다. 결함과 **장애(failure)**은 다르다. 일반적으로 결함은 사양에서 벗어난 시스템의 한 구성요소로 정의되지만, 장애는 사용자에게 필요한 서비스를 제공하지 못하고 시스템 전체가 멈춘 경우다. **결함을 0으로 줄이는 것은 불가능하기 때문에 결함으로 인해 장개가 발생하지 않게끔 내결함성 구조를 설계하는 것이 가장 좋다**.

고의적으로 결함을 유도함으로써 내결함성 시스템을 지속적으로 훈련하고 테스트해서 결함이 자연적으로 발생했을 때 올바르게 처리할 수 있다는 자신감을 높인다. **Netflix의 [Chaos Monkey](https://netflix.github.io/chaosmonkey/)**가 이런 접근 방식의 예이다.

### 하드웨어 결함

하드디스크 고장, 램 결함, 대규모 정전 사태 등을 말한다. 이를 해결하기 위해 소프트웨어 내결함성 기술을 사용하거나 하드웨어 중복성을 추가해 전체 장비의 손실을 견딜 수 있는 시스템으로 점점 옮겨가고 있다.

### 소프트웨어 오류

잘못된 특정 입력에 모든 서버가 죽는 버그, 공유 자원을 과도하게 사용하는 일부 프로세스, 연쇄 장애 등의 시스템 내 체계적 오류(systematic error)를 말한다. 이 결함은 예상하기 어렵고 노드 간 상관관계 때문에 하드웨어 결함보다 오히려 시스템 오류를 더 유발하는 경향이 있다.

소프트웨어 오류를 해결하기 위한 신속한 해결책은 없다. 시스템의 가정과 상호작용에 대해 주의 깊게 생각하기, 빈틈없는 테스트, 프로세스 격리(process isolation), 모니터링, 분석하기 등과 같은 여러 작은 일들이 문제 해결에 도움을 준다.

### 인적 오류

운영자의 설정 오류 등과 같이 사람의 실수로 인해 발생하는 오류를 말함. 오류의 가능성을 최소화하는 방향으로 시스템을 설계하기, 사람이 가장 많이 실수하는 부분에서 사람의 실수로 장애가 발생할 수 있는 부분을 분리하기, 철저하게 테스트하기, 인적 오류를 빠르고 쉽게 복구할 수 있게 하기 등과 같은 방법으로 보완할 수 있다.

## 확장성

> 시스템의 데이터 양, 트래픽 양, 복잡도가 증가하면서 이를 처리할 수 있는 적절한 방법이 있어야 한다.

확장성은 증가한 부하에 대처하는 시스템 능력을 설명하는데 사용하는 용어로 **확장성을 논한다는 것은 "시스템이 특정 방식으로 커지면 이에 대처하기 위한 선택은 무엇인가?", "추가 부하를 다루기 위해 계산 자원을 어떻게 투입할까?" 와 같은 질문을 고려한다는 의미**다.

### 부하 기술하기

무엇보다 시스템의 현재 부하를 간결하게 기술해야 한다. 그래야 부하 성장 질문(부하가 두 배로 되면 어떻게 될까?)을 논의할 수 있다. 부하는 웹 서버의 초당 요청 수, DB 읽기 대 쓰기 비율, Active user수, 캐시 적중률 등과 같은 **부하** **매개변수(load parameter)**로 나타낼 수 있다.

### 성능 기술하기

시스템의 부하를 기술하면 부하가 증가할 때 어떤 일이 일어나는지 조사할 수 있다. 다음 두가지 방법으로 살펴볼 수 있다.

- 부하 매개 변수를 증가시키고 시스템 자원(CPU, 메모리, 네트워크 대역폭 등)은 변경하지 않고 유지하면 시스템 성능은 어떻게 영향을 받을까?
- 부하 매개변수를 증가시켰을 때 성능이 변하지 않고 유지되길 원한다면 자원을 얼마나 늘려야 할까?

하둡(Hadoop)과 같은 일괄 처리 시스템 보통 처리량(throughput)에 관심을 가진다. 온라인 시스템에서는 서비스 응답 시간(response time)에 더 관심을 가진다.

동일한 요청을 하더라도 매번 응답 시간이 다르다. 때문에 **응답 시간은 단일 숫자(평균)보다는 측정 가능한 값의 분포로 생각해야 한다**. 즉, 백분위(percentile)을 사용하는 편이 더 좋다.

**백분위 예**

- p50 - 50분위
- p95 - 95분위
- p99 - 99분위

**꼬리 지연 시간(tail latency)로 알려진 상위 백분위 응답 시간은 서비스의 사용자 경험에 직접 영향을 주기 때문에 중요하다.** 백분위는 서비스 수준 목표(service level objective, SLO)와 서비스 수준 협약서(service level agreement, SLA)에 자주 사용한다.

### 부하 대응 접근 방식

부하 매개변수가 어느 정도 증가하더라도 좋은 성능을 유지하려면 어떻게 해야 할까?

일반적으로 **용량 확장(scaling up; 수직 확장(vertical scaling)**, 좀 더 강력한 장비로 이동)과 **규모 확장(scaling out; 수평 확장(horizontal scaling)**, 다수의 낮은 사양 장비에 부하를 분산)으로 구분해서 말한다.

특정 애플리케이션에 적합한 확장성을 갖춘 아키텍처는 주요 동작이 무엇이고 잘 하지 않는 동작이 무엇인지에 대한 가정을 바탕으로 구축한다.

## 관련 글

- [1장. 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 애플리케이션 - 유지보수성](</study/study-DIA-ch01(2)/>)

## Reference

- [데이터 중심 애플리케이션 설계](http://www.yes24.com/Product/Goods/59566585)
